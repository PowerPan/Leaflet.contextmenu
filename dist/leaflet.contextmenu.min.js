/*! leaflet.contextmenu 2016-09-14 Copyright by   */
!function(a){var b;if("function"==typeof define&&define.amd)define(["leaflet"],a);else if("undefined"!=typeof module)b=require("leaflet"),module.exports=a(b);else{if("undefined"==typeof window.L)throw new Error("Leaflet must be loaded first");a(window.L)}}(function(a){a.Map.mergeOptions({contextmenuItems:[]}),a.Map.ContextMenu=a.Handler.extend({_touchstart:a.Browser.msPointer?"MSPointerDown":a.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(b){a.Handler.prototype.initialize.call(this,b),this._items=[],this._visible=!1;var c=this._container=a.DomUtil.create("div",a.Map.ContextMenu.BASE_CLS,b._container);c.style.zIndex=1e4,c.style.position="absolute",b.options.contextmenuWidth&&(c.style.width=b.options.contextmenuWidth+"px"),this._createItems(),a.DomEvent.on(c,"click",a.DomEvent.stop).on(c,"mousedown",a.DomEvent.stop).on(c,"dblclick",a.DomEvent.stop).on(c,"contextmenu",a.DomEvent.stop)},addHooks:function(){var b=this._map.getContainer();a.DomEvent.on(b,"mouseleave",this._hide,this).on(document,"keydown",this._onKeyDown,this),a.Browser.touch&&a.DomEvent.on(document,this._touchstart,this._hide,this),this._map.on({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this)},removeHooks:function(){var b=this._map.getContainer();a.DomEvent.off(b,"mouseleave",this._hide,this).off(document,"keydown",this._onKeyDown,this),a.Browser.touch&&a.DomEvent.off(document,this._touchstart,this._hide,this),this._map.off({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this)},showAt:function(b,c){b instanceof a.LatLng&&(b=this._map.latLngToContainerPoint(b)),this._showAtPoint(b,c)},hide:function(){this._hide()},addItem:function(a){return this.insertItem(a)},insertItem:function(a,b){b=void 0!==b?b:this._items.length;var c=this._createItem(this._container,a,b);return this._items.push(c),this._sizeChanged=!0,this._map.fire("contextmenu.additem",{contextmenu:this,el:c.el,index:b}),c.el},removeItem:function(b){var c=this._container;isNaN(b)||(b=c.children[b]),b&&(this._removeItem(a.Util.stamp(b)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,el:b}))},removeAllItems:function(){for(var b;this._container.children.length;)b=this._container.children[0],this._removeItem(a.Util.stamp(b))},hideAllItems:function(){var a,b,c;for(b=0,c=this._items.length;b<c;b++)a=this._items[b],a.el.style.display="none"},showAllItems:function(){var a,b,c;for(b=0,c=this._items.length;b<c;b++)a=this._items[b],a.el.style.display=""},setDisabled:function(b,c){var d=this._container,e=a.Map.ContextMenu.BASE_CLS+"-item";isNaN(b)||(b=d.children[b]),b&&a.DomUtil.hasClass(b,e)&&(c?(a.DomUtil.addClass(b,e+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:b})):(a.DomUtil.removeClass(b,e+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:b})))},isVisible:function(){return this._visible},_createItems:function(){var a,b,c=this._map.options.contextmenuItems;for(a=0,b=c.length;a<b;a++)this._items.push(this._createItem(this._container,c[a]))},_createItem:function(b,c,d){if(c.separator||"-"===c)return this._createSeparator(b,d);var e=a.Map.ContextMenu.BASE_CLS+"-item",f=c.disabled?e+" "+e+"-disabled":e,g=this._insertElementAt("a",f,b,d),h=this._createEventHandler(g,c.callback,c.context,c.hideOnSelect),i="";return c.icon?i='<img class="'+a.Map.ContextMenu.BASE_CLS+'-icon" src="'+c.icon+'"/>':c.iconCls&&(i='<span class="'+a.Map.ContextMenu.BASE_CLS+"-icon "+c.iconCls+'"></span>'),g.innerHTML=i+c.text,g.href="#",a.DomEvent.on(g,"mouseover",this._onItemMouseOver,this).on(g,"mouseout",this._onItemMouseOut,this).on(g,"mousedown",a.DomEvent.stopPropagation).on(g,"click",h),{id:a.Util.stamp(g),el:g,callback:h}},_removeItem:function(b){var c,d,e,f,g;for(e=0,f=this._items.length;e<f;e++)if(c=this._items[e],c.id===b)return d=c.el,g=c.callback,g&&a.DomEvent.off(d,"mouseover",this._onItemMouseOver,this).off(d,"mouseover",this._onItemMouseOut,this).off(d,"mousedown",a.DomEvent.stopPropagation).off(d,"click",g),this._container.removeChild(d),this._items.splice(e,1),c;return null},_createSeparator:function(b,c){var d=this._insertElementAt("div",a.Map.ContextMenu.BASE_CLS+"-separator",b,c);return{id:a.Util.stamp(d),el:d}},_createEventHandler:function(b,c,d,e){var f=this,g=this._map,h=a.Map.ContextMenu.BASE_CLS+"-item-disabled",i=void 0===e||e;return function(e){a.DomUtil.hasClass(b,h)||(i&&f._hide(),c&&c.call(d||g,f._showLocation),f._map.fire("contextmenu:select",{contextmenu:f,el:b}))}},_insertElementAt:function(a,b,c,d){var e,f=document.createElement(a);return f.className=b,void 0!==d&&(e=c.children[d]),e?c.insertBefore(f,e):c.appendChild(f),f},_show:function(a){this._showAtPoint(a.containerPoint,a)},_showAtPoint:function(b,c){if(this._items.length){var d=this._map,e=d.containerPointToLayerPoint(b),f=d.layerPointToLatLng(e),g=a.extend(c||{},{contextmenu:this});this._showLocation={latlng:f,layerPoint:e,containerPoint:b},c&&c.relatedTarget&&(this._showLocation.relatedTarget=c.relatedTarget),this._setPosition(b),this._visible?this._setPosition(b):(this._container.style.display="block",this._visible=!0),this._map.fire("contextmenu.show",g)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",{contextmenu:this}))},_setPosition:function(b){var c,d=this._map.getSize(),e=this._container,f=this._getElementSize(e);this._map.options.contextmenuAnchor&&(c=a.point(this._map.options.contextmenuAnchor),b=b.add(c)),e._leaflet_pos=b,b.x+f.x>d.x?(e.style.left="auto",e.style.right=Math.max(d.x-b.x,0)+"px"):(e.style.left=Math.max(b.x,0)+"px",e.style.right="auto"),b.y+f.y>d.y?(e.style.top="auto",e.style.bottom=Math.max(d.y-b.y,0)+"px"):(e.style.top=Math.max(b.y,0)+"px",e.style.bottom="auto")},_getElementSize:function(a){var b=this._size,c=a.style.display;return b&&!this._sizeChanged||(b={},a.style.left="-999999px",a.style.right="auto",a.style.display="block",b.x=a.offsetWidth,b.y=a.offsetHeight,a.style.left="auto",a.style.display=c,this._sizeChanged=!1),b},_onKeyDown:function(a){var b=a.keyCode;27===b&&this._hide()},_onItemMouseOver:function(b){a.DomUtil.addClass(b.target||b.srcElement,"over")},_onItemMouseOut:function(b){a.DomUtil.removeClass(b.target||b.srcElement,"over")}}),a.Map.addInitHook("addHandler","contextmenu",a.Map.ContextMenu),a.Mixin.ContextMenu={bindContextMenu:function(b){return a.setOptions(this,b),this._initContextMenu(),this},unbindContextMenu:function(){return this.off("contextmenu",this._showContextMenu,this),this},addContextMenuItem:function(a){this.options.contextmenuItems.push(a)},removeContextMenuItemWithIndex:function(a){for(var b=[],c=0;c<this.options.contextmenuItems.length;c++)this.options.contextmenuItems[c].index==a&&b.push(c);for(var d=b.pop();void 0!==d;)this.options.contextmenuItems.splice(d,1),d=b.pop()},replaceConextMenuItem:function(a){this.removeContextMenuItemWithIndex(a.index),this.addContextMenuItem(a)},_initContextMenu:function(){this._items=[],this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(b){var c,d,e,f,g;if(this._map.contextmenu){for(d=a.extend({relatedTarget:this},b),e=this._map.mouseEventToContainerPoint(b.originalEvent),this.options.contextmenuInheritItems||this._map.contextmenu.hideAllItems(),f=0,g=this.options.contextmenuItems.length;f<g;f++)c=this.options.contextmenuItems[f],this._items.push(this._map.contextmenu.insertItem(c,c.index));this._map.once("contextmenu.hide",this._hideContextMenu,this),this._map.contextmenu.showAt(e,d)}},_hideContextMenu:function(){var a,b;for(a=0,b=this._items.length;a<b;a++)this._map.contextmenu.removeItem(this._items[a]);this._items.length=0,this.options.contextmenuInheritItems||this._map.contextmenu.showAllItems()}};var b,c,d,e=[a.Marker,a.Path],f={contextmenu:!1,contextmenuItems:[],contextmenuInheritItems:!0};for(c=0,d=e.length;c<d;c++)b=e[c],b.prototype.options?b.mergeOptions(f):b.prototype.options=f,b.addInitHook(function(){this.options.contextmenu&&this._initContextMenu()}),b.include(a.Mixin.ContextMenu);return a.Map.ContextMenu});